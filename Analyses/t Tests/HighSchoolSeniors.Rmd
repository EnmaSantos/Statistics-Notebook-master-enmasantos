---
title: "High School Seniors t Test"
output: 
  html_document:
    theme: cerulean
    code_folding: hide
---

```{r, message=FALSE, warning=FALSE}
library(tidyverse)
library(DT)
library(pander)
library(readr)



HSS <- read_csv("../../Data/HighSchoolSeniors.csv")

# View(HSS)
# nrow(HSS)
# head(HSS)
# colnames(HSS)
#If this code does not work: 
#Use the top menu from RStudio's window to select "Session, Set Working Directory, To Source File Location", and then play this R-chunk into your console to read the HSS data into R. 

## In your Console run View(HSS) to ensure the data has loaded correctly.
```


<!-- Instructions

1. Use the HSS dataset in R to come up with a question that can be answered with a t Test. 

Here is a link to the survey given to the students that participated in the study:
https://ww2.amstat.org/censusatschool/pdfs/C@SQuestionnaire.pdf
(Use the link to learn about what each column of data in the data set represents.)

2. Establish why your question is interesting and rephrase the question using a statistical "null" and "alternative" hypothesis. (Hint, see the "Math 325 Notebook -> R Help -> R-Markdown Hints" page of your textbook for instructions on how to write mathematical hypotheses.)

3. Clearly answer your question using statistics. Be sure to compute a p-value and provide supporting numerical and graphical summaries. If your conclusions don't have numbers in them, they likely are not detailed enough to be meaningful conclusions.

Note: you can create "groups" from the data in many ways. For example, suppose you wanted to create a variable that grouped people according to whether they thought recycling was more important than conserving water. You could do this by:

```{r}
HSS <- HSS %>%
  mutate(recycling_than_water = ifelse(Importance_recycling_rubbish >	Importance_conserving_water, "Recycling More Important", "Water Conservation More Important"))
```

4. Include Q-Q Plots checking the normality of the data and discuss if the requirements of the test are satisfied for your data or not. Note that Q-Q Plots are not graphics, they are diagnostic plots diagnosing the normality of the data.


-->

Questions & Hypotheses
----------------------

This analysis seeks to explore a potential link between personality preferences and physical reflexes. The choice of a superpower can reflect a person's underlying desires---be it for speed, control, or something else. We are investigating whether this choice correlates with a measurable performance metric like reaction time. Specifically, we will answer the question: **Is there a statistically significant difference in the average reaction time between high school seniors who would choose the ability to fly and those who would choose the ability to freeze time?**

To investigate this question statistically, we will use the following hypotheses, where μfly​ represents the true average reaction time for students who would choose to fly, and μfreeze​ represents the true average reaction time for students who would choose to freeze time.

-   **Null Hypothesis (H0​):** There is no difference in the average reaction time between the two groups.

$$
H_0: \mu_\text{fly} - \mu_\text{freeze} = 0
$$

-   **Alternative Hypothesis (HA​):** There is a difference in the average reaction time between the two groups.

$$
H_A: \mu_\text{fly} - \mu_\text{freeze} \neq 0
$$

We will test these hypotheses at a significance level of α=0.05.




Analysis
--------

First, we prepare the data. We use `mutate()` to convert the `Reaction_time` column from text to a number, which turns any non-numeric values (like "7-Jun") into `NA`. Then, we filter for our two groups and use `drop_na()` to remove the missing values, leaving a clean dataset for analysis.

```{r warning=FALSE}

superpower_data <- HSS %>%
  mutate(Reaction_time = as.numeric(Reaction_time)) %>% 
  filter(Superpower %in% c("Fly", "Freeze time")) %>%
  drop_na(Reaction_time)


# cat("Final counts of students in each group after cleaning:\n")
pander(table(superpower_data$Superpower))
```

Graphical Summary
-----------------

To visually compare the distributions of reaction times for the two groups, a side-by-side boxplot is an effective tool. This graphic is designed to be stand-alone, with a descriptive title, clear labels, and a caption explaining the visual.
```{r warning=FALSE}

ggplot(superpower_data, aes(x = Superpower, y = Reaction_time, fill = Superpower)) +
  geom_boxplot(alpha = 0.7) +
  labs(
    title = "Reaction Time by Preferred Superpower",
    subtitle = "Comparing Seniors Who Chose 'Fly' vs. 'Freeze Time'",
    x = "Preferred Superpower",
    y = "Reaction Time (seconds)",
    caption = "Figure 1: Boxplots showing the distribution of reaction times for each superpower choice."
  ) +
  theme_minimal() +
  theme(legend.position = "none")
```

## Analysis {.tabset .tabset-pills}

### t Test

#### Diagnostic Plots & Assumption Check

As required for a two-sample t-test, we must check that the data from each group is approximately normally distributed. We can check this assumption by examining a Q-Q (Quantile-Quantile) plot for each group.

```{r warning=FALSE}

par(mfrow = c(1, 2))


fly_group <- superpower_data %>% filter(Superpower == "Fly")
qqnorm(fly_group$Reaction_time, main = "Q-Q Plot: Fly Group")
qqline(fly_group$Reaction_time)


freeze_group <- superpower_data %>% filter(Superpower == "Freeze time")
qqnorm(freeze_group$Reaction_time, main = "Q-Q Plot: Freeze Time Group")
qqline(freeze_group$Reaction_time)


par(mfrow = c(1, 1))
```
The points in both Q-Q plots fall reasonably close to the reference line. Although there are some deviations in the tails, particularly for the 'Fly' group, the large sample sizes (nFly​=95, nFreezetime​=110) make the t-test robust to these slight departures from normality. Therefore, **the normality assumption is adequately met.**

#### Performing the t-Test

Now we perform the two-sample t-test to compare the mean reaction times and compute our p-value.

```{r warning=FALSE}

t_test_results <- t.test(Reaction_time ~ Superpower, data = superpower_data)
pander(t_test_results, split.table = Inf)
```

#### Interpretation

The analysis was performed to determine if a significant difference exists in reaction times between students preferring the ability to fly versus those preferring to freeze time. The mean reaction time for the 'Fly' group was **0.456** seconds, while the mean for the 'Freeze Time' group was **0.3668** seconds.

The two-sample t-test yielded a p-value of **0.06238**. Since this p-value is **greater than** our pre-determined significance level of α=0.05, we **fail to reject** the null hypothesis.

Based on this result, we conclude that there **is not** a statistically significant difference in the average reaction time between high school seniors who would prefer to fly and those who would prefer to freeze time.

### Wilcoxon Test

The Wilcoxon Rank-Sum test (also known as the Mann-Whitney U test) is a non-parametric alternative to the two-sample t-test. It tests whether two independent samples come from populations with the same distribution.

#### Hypotheses

The hypotheses for the Wilcoxon test are:

-   **Null Hypothesis (H0​):** The distributions of reaction times for the two groups are identical.

$$
H_0: \text{The distributions are the same}
$$

-   **Alternative Hypothesis (HA​):** The distributions of reaction times for the two groups are different.

$$
H_A: \text{The distributions are different}
$$

#### Performing the Wilcoxon Test

```{r warning=FALSE}

# Perform the Wilcoxon Rank-Sum test
wilcox_test_results <- wilcox.test(Reaction_time ~ Superpower, data = superpower_data, alternative = "two.sided")
pander(wilcox_test_results, split.table = Inf)

```

#### Numerical Summary

Since the Wilcoxon test doesn't provide mean values in its output like the t-test does, we compute the numerical summaries separately:

```{r warning=FALSE}
# Numerical summary for Wilcoxon test section
wilcox_summary <- superpower_data %>%
  group_by(Superpower) %>%
  summarise(
    Mean = mean(Reaction_time),
    Median = median(Reaction_time),
    SD = sd(Reaction_time),
    n = n(),
    .groups = 'drop'
  )
pander(wilcox_summary)
```

#### Interpretation and Comparison

The Wilcoxon test gives a p-value of **0.04437**. Since this p-value is **less than** our significance level of $\alpha=0.05$, we **reject** the null hypothesis ($H_0$). This test suggests there is a statistically significant difference in reaction times between the two groups.

The mean reaction time for the 'Fly' group was **0.456** seconds, while the mean for the 'Freeze Time' group was **0.3668** seconds. The Wilcoxon test indicates that these differences are statistically significant.

**Comparison with t-Test:**

Comparing the results from both tests reveals an interesting discrepancy:

-   **t-Test:** The two-sample t-test yielded a p-value of **0.06238**, which is greater than α=0.05, leading us to **fail to reject** the null hypothesis. This suggests **no statistically significant difference** between the groups.

-   **Wilcoxon Test:** The Wilcoxon Rank-Sum test yielded a p-value of **0.04437**, which is less than α=0.05, leading us to **reject** the null hypothesis. This suggests a **statistically significant difference** between the groups.

This difference in conclusions can be attributed to the fact that the Wilcoxon test is a non-parametric test that doesn't assume normality and is based on ranks rather than means. It may be more sensitive to differences in distribution shape or outliers. The t-test, which assumes normality and uses actual values, may be less sensitive to certain types of differences, especially when the normality assumption is only approximately met (as we observed some deviations in the Q-Q plots).

## Conclusion

### Summary of Results

Comparing the results from both tests reveals an interesting discrepancy:

-   **t-Test:** The two-sample t-test yielded a p-value of **0.06238**, which is greater than α=0.05, leading us to **fail to reject** the null hypothesis. This suggests **no statistically significant difference** between the groups.

-   **Wilcoxon Test:** The Wilcoxon Rank-Sum test yielded a p-value of **0.04437**, which is less than α=0.05, leading us to **reject** the null hypothesis. This suggests a **statistically significant difference** between the groups.

The mean reaction times are **0.456** seconds for the 'Fly' group and **0.3668** seconds for the 'Freeze Time' group, showing a practical difference regardless of statistical significance.

### Which Test is More Appropriate?

**The Wilcoxon test is more appropriate for this data** for the following reasons:

1. **Normality Assumption Concerns:** While the Q-Q plots showed that the data is approximately normally distributed, there were some deviations in the tails, particularly for the 'Fly' group. The Wilcoxon test does not require the normality assumption, making it more robust to these departures.

2. **Sample Size Considerations:** Although large sample sizes (nFly=95, nFreezetime=110) make the t-test more robust to violations of normality, the Wilcoxon test remains valid regardless of distribution shape and provides a more conservative approach when assumptions are questionable.

3. **Sensitivity to Outliers:** The Wilcoxon test, being based on ranks rather than actual values, is less sensitive to outliers. Reaction time data can sometimes contain extreme values that may unduly influence the t-test results.

4. **Non-Parametric Advantage:** Since we cannot be completely certain that the normality assumption is perfectly met, the non-parametric Wilcoxon test provides a safer choice that doesn't rely on distributional assumptions.

**Conclusion:** Based on the Wilcoxon test results, there **is** a statistically significant difference in reaction times between high school seniors who would choose to fly versus those who would choose to freeze time. The mean reaction time for the 'Fly' group (0.456 seconds) is higher than that for the 'Freeze Time' group (0.3668 seconds), suggesting that students who prefer the ability to freeze time tend to have faster reaction times on average.


